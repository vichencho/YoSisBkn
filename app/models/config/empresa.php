<?php
/**
 * Dailyscript - Web | App | Media
 *
 * Clase que se encarga de todo lo relacionado con la información de la empresa
 *
 * @category
 * @package     Models
 * @subpackage
 * @author      Iván D. Meléndez (ivan.melendez@dailyscript.com.co)
 * @copyright   Copyright (c) 2013 Dailyscript Team (http://www.dailyscript.com.co) 
 */

class Empresa extends ActiveRecord {

    /**
     * Método para definir las relaciones y validaciones
     */
    protected function initialize() {    
        $this->has_many('sucursal');   
        $this->belongs_to('tipo_nuip'); 
        $this->belongs_to('usuario'); 
                                         
        $this->validates_presence_of('razon_social', 'message: Ingresa el nombre de la empresa');
        $this->validates_presence_of('representante_legal', 'message: Ingresa el nombre del propietario o representante legal.');
        $this->validates_presence_of('nuip', 'message: Ingresa el NUIP o NIT de la empresa.');       
        $this->validates_email_in('email', 'message: El correo electrónico es incorrecto.');
    }

    /**
     * Método para obtener la información de la empresa
     * @return obj
     */
    public function getInformacionEmpresa() {
        return $this->find_first();
    }    
    

    /**
     * Método para obtener la información de la empresa
     * @return obj
     */
    public function getSucursalPrincipal() {
        return $this->find_first('id=1');
    }    
    
    /**
     * Método para registrar y modificar los datos de la empresa
     * 
     * @param string $method Método para guardar en la base de datos (create, update)
     * @param array $data Array de datos para la autocarga de objetos
     * @param arraty $other Se utiliza para autocargar datos adicionales al objeto
     * @return Empresa
     */
    public static function setEmpresa($method, $data, $optData=null) {
        $obj = new Empresa($data);
        if($optData) {
            $obj->dump_result_self($optData);
        }
        $rs = $obj->$method();
        return ($rs) ? $obj : FALSE;            
    }/*
    
    public function after_save() {
        Session::delete('empresa', 'config');
        //Si no está habilitado para el manejo de sucursal
        //registro la ubicación de la empresa como sucursal
         Comentado hasta manejar sucursales
        if(!APP_OFFICE && Input::hasPost('sucursal')) {             
            Sucursal::setSucursal('save', Input::post('sucursal'), array('sucursal'=>'Oficina Principal', 'ciudad'=>Input::post('ciudad'), 'empresa_id'=>$this->id));
        }
        
    }
*/
    /**
     * Método para filtrar la información de la empresa
     */
    public function getFiltradoEmpresa() {        
        $this->razon_social = Filter::get($this->razon_social, 'string');
        $this->siglas = Filter::get($this->siglas, 'string');
        $this->representante_legal = Filter::get($this->representante_legal, 'string');
        $this->nit = Filter::get($this->nit, 'numeric');
        $this->dv = Filter::get($this->dv, 'numeric');        
        $this->nuip = Filter::get($this->nuip, 'numeric');
        $this->email = Filter::get($this->email, 'string');
        $this->pagina_web = Filter::get($this->pagina_web, 'string');        
    }
    
}
?>

